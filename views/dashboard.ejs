<link rel="stylesheet" href="/css/dashboard.css">

<script type="text/javascript">
    __f5__.closeModal = function () {
        let modal = document.querySelector('.modal-container');
        if (modal) {
            const closeBtn = modal.querySelector('.ic-close');
            if (closeBtn) { closeBtn.removeEventListener('click', __f5__.modalCloseListener); }

            const cancelBtn = modal.querySelector('#cancel-btn');
            if (cancelBtn) { cancelBtn.removeEventListener('click', __f5__.modalCloseListener); }

            modal.remove();
        }
    };
    __f5__.modalCloseListener = __f5__.closeModal;
    __f5__.parseModalHTML = function (data, cssclass) {
        const domParser = new DOMParser();
        const doc = domParser.parseFromString(data, 'text/html');
        
        this.closeModal();
        
        const modal = doc.querySelector('.modal-container');
        if (cssclass) { modal.classList.add(cssclass); }

        const closeBtn = modal.querySelector('.ic-close');
        if (closeBtn) { closeBtn.addEventListener('click', __f5__.modalCloseListener); }

        const cancelBtn = modal.querySelector('#cancel-btn');
        if (cancelBtn) { cancelBtn.addEventListener('click', __f5__.modalCloseListener); }

        document.querySelector('.dashboard__main').appendChild(modal);
        doc.clear();
    };
    __f5__.orders = {
        delete: function (e) {
            const reqId = e.target.dataset.id;
            $.ajax({
                url: `/dashboard/requests/${reqId}`,
                type: 'DELETE',
                success: function (data) {
                    __f5__.parseModalHTML(data, 'deleted-request');
                }
            });
        },
        listenCancel: () => {
            document.querySelector('#order-cancel').addEventListener('click', function () {
                const id = this.dataset.id;
                const url = `/dashboard/requests/delete/${id}`;
                $.get(url, (data) => {
                    __f5__.parseModalHTML(data, 'delete-request');
                    document.querySelector('#delete-btn').addEventListener('click', __f5__.orders.delete);
                });
            });
        }
    };
    __f5__.removeDashLoader();
    function navigate(e) {
        __f5__.router.navigate(e.target.dataset.route);
    };
    // document.querySelector('a#new-bin-link').addEventListener('click', navigate);
</script>

<div class="dashboard">
    <!-- <% if (org.payed) { %>
    <a id="new-bin-link" href="#" data-route="/dashboard/bins/cadastrar" class="btn-md btn--primary capitalize">cadastrar
        ponto</a>
    <% } else { %>
    <button id="new-bin-link" class="btn-md btn--inactive capitalize" disabled>solicitar bin</button>
    <% } %> -->
    <%- include('partials/sidebar') %>
    <div class="dashboard__body">        
        <%- include('layouts/dashboard') %>
        <!-- <div class="dashboard-loader hide"></div> -->
    </div>    
</div>
